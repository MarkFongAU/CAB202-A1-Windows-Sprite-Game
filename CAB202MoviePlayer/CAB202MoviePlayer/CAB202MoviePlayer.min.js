/*! CAB202MoviePlayer.js 1.0.0.0
 * 
 */
require(["ss","SystemQut_Client"],function(n,t){function s(){}function u(){}function f(t){this.$a=[],this.$b=[],this.$c=0,this.$d=0,this.$e=0,this.$f=!1,this.$g=0,this.$i=0,this.$k=undefined,this.$0=t,this.$3=this.$C("div","displayArea"),this.$4=this.$C("div","screenHolder"),this.$5=this.$C("p","movieTitle"),this.$6=this.$C("textarea","screen"),this.$8=this.$C("span","currentTimeLabel"),this.$9=this.$C("span","maxTimeLabel"),this.$l=this.$C("p","keyDisplay"),this.$2=this.$C("button","playButton"),this.$2.addEventListener("click",n.bind("$B",this),!1),this.$4.style.display="block",this.$1=this.$C("input","fileControl"),this.$1.addEventListener("change",n.bind("$w",this),!1),this.$7=this.$C("input","slider"),this.$7.addEventListener("change",n.bind("$m",this),!1),this.add_propertyChanged(n.bind("$n",this))}function i(){this.frameType=0,this.timeStamp=0,this.width=0,this.height=0,this.charCode=0}function r(){}var c=this,e,o,h;u.listsEqual_$$$_1=function(n,t,i,r,u){var f;if(n.length!==t.length)return!1;for(f=0;f<n.length;f++){var e=n[f],o=t[f],s=i(e,o);if(!s)return r.item=e,u.item=o,!1}return!0},e={add_propertyChanged:function(t){this.$h=n.bindAdd(this.$h,t)},remove_propertyChanged:function(t){this.$h=n.bindSub(this.$h,t)},$m:function(){var n=parseFloat(this.$7.value),t=parseFloat(this._slider.step),i=Math.floor(this.$g/t),r=Math.floor(n*i/this.$g);this.set_$x(this.$b[r])},$n:function(n,t){t.get_propertyNames().indexOf("ScreenPlay")>=0&&this.$q(),t.get_propertyNames().indexOf("FrameIdx")>=0&&this.$p(),t.get_propertyNames().indexOf("IsPlaying")>=0&&this.$o()},$o:function(){this.$2.textContent=this.$f?"Pause":"Play",this.$f&&this.$r()},$p:function(){this.$i=this.$e<this.$a.length?this.$a[this.$e].timeStamp:0,console.log("MoviePlayer_PropertyChanged: currentTime = "+this.$i),this.$8.textContent=this.$i.toFixed(2),this.$7.value=this.$i.toFixed(2),this.$s()},$q:function(){var i,t,r;this.$g=this.$a[this.$a.length-1].timeStamp,this.$f=!1,this.$e=this.$d,this.$7.value=(0).toString(),i=this.$a.length>0?this.$g.toFixed(2):(0).toString(),this.$7.setAttribute("max",i),this.$9.textContent=i,this.$b.length=0;var u=parseFloat(this._slider.step),f=Math.floor(this.$g/u),n=0;for(t=0;t<this.$g;t+=u)while(n<this.$a.length){if(r=this.$a[n],!r.frameType&&r.timeStamp>=t){this.$b.push(n);break}n++}this.$A(),this.$s()},$r:function(){if(this.$f)if(this.set_$x(this.get_$x()+1)-1,this.$e<this.$a.length-1){var t=this.$a[this.$e].timeStamp,i=this.$a[this.$e+1].timeStamp;setTimeout(n.bind("$r",this),Math.floor((i-t)*1e3))}else this.set_isPlaying(!1)},$s:function(){if(this.$e<this.$a.length){var n=this.$a[this.$e];n.frameType?this.$t(n):this.$v(n)}},$t:function(t){var i=t.charCode;i>0&&(n.isValue(this.$k)&&(clearTimeout(this.$k),this.$k=undefined),this.$l.innerText=n.format("Key: {0}  {1}",i,String.fromCharCode(i)),this.$k=setTimeout(n.bind("$u",this),500))},$u:function(){this.$l.innerHTML="&nbsp;"},$v:function(n){this.$6.textContent="",this.$6.rows=n.height,this.$6.cols=n.width;for(var t=0;t<n.height;t++)this.$6.textContent+=n.cells[t],this.$6.textContent+="\n"},$w:function(){this.$1.files.length>=1&&(this.$j=this.$1.files[0],this.$y(this.$j),this.$A())},get_$x:function(){return this.$e},set_$x:function(n){var t=this.$e;return this.$e=Math.min(Math.max(n,0),this.$a.length),this.$e!==t&&this.$z("FrameIdx"),n},$y:function(r){var u=this,f=new FileReader;f.onload=function(){var o=f.result,s=new t.StringReader(o),r,e;for(u.$a.length=0,u.$c=0,u.$d=undefined,e=0;null!==(r=i.parse(s));)u.$a.length||(e=r.timeStamp),r.timeStamp-=e,r.frameType||(n.isValue(u.$d)||(u.$d=u.$a.length),u.$c++),u.$a.push(r);while(u.$a.length>0&&u.$a[u.$a.length-1].frameType===1)u.$a.length--;u.$z("ScreenPlay")},f.readAsText(r)},$z:function(n){this.$h!=null&&this.$h(this,new t.PropertyChangedEventArgs(n))},$A:function(){this.$5.textContent=n.format("{0} ({1} bytes; {2} frames)",this.$j.name,this.$j.size,this.$c)},$B:function(){this.$a.length&&this.set_isPlaying(!this.$f)},$C:function(n,t){for(var u=this.$0.getElementsByTagName(n),r,i=0;i<u.length;i++)if(r=u[i],r.id===t)return r;return null},get_isPlaying:function(){return this.$f},set_isPlaying:function(n){var t=this.$f;return n!==t&&(this.$f=n,this.$z("IsPlaying")),n}},i.areEqual=function(n,t){return n===t?!0:n==null&&t!=null?!1:(n!=null&&t==null,!1)},i.parse=function(t){for(var r=t.readLine(),e;r!=null&&!n.startsWith(r,"Frame(")&&!n.startsWith(r,"Char(");)r=t.readLine();if(r==null)return null;var u=new i,f=r.split(new RegExp("[\\(,\\)]"));if(f.length>=3&&f[0]==="Char")u.frameType=1,u.charCode=parseInt(f[1]),u.timeStamp=parseFloat(f[2]);else if(f.length>=4&&f[0]==="Frame")for(u.frameType=0,u.width=parseInt(f[1]),u.height=parseInt(f[2]),u.timeStamp=parseFloat(f[3]),u.cells=[],e=0,r=t.readLine();r!=null&&!n.startsWith(r,"EndFrame");)e<u.height&&(u.cells[e++]=r),r=t.readLine();else console.log("Expected Char or Frame declaration"),console.log(n.format("Input text: ((({0})))",r));return u},o={toString:function(){var t=new n.StringBuilder,i;if(this.frameType===1)t.append(n.format("Char({0},{1})\n",this.charCode,this.timeStamp));else{for(t.append(n.format("Frame({0},{1},{2})\n",this.width,this.height,this.timeStamp)),i=0;i<this.height;i++)t.append(this.cells[i]),t.append("\n");t.append("EndFrame\n")}return t.toString()},$0:function(){return null}},r.run=function(){var n=new f(document.getElementById("moviePlayer"))},h=n.module("CAB202MoviePlayer",null,{FrameType:{screen:0,character:1},Reference_$$$_1:[s,{},null],Util:[u,null,null],MoviePlayer:[f,e,null,t.INotifyPropertyChanged],Frame:[i,o,null],Main:[r,null,null]}),r.run()})